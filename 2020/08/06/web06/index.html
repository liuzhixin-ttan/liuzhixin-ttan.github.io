<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Web前端 (6) ES6知识总结 | Hexo</title><meta name="description" content="可以说ECMAScript 是 JavaScript 语言的国际标准，JavaScript 是 ECMAScript 的实现。 let&amp;const命令​    ES6 新增了 let 命令，用来声明变量，使用它声明的变量只在所在的代码块中有效。 ​    ES6 新增了 const 命令，用来声明常量，使用它声明的常量只在所在的代码块中有效。    let声明变量 var声明变量 cons"><meta name="keywords" content="web前端,知识总结,ES6,ES7"><meta name="author" content="ttan12138"><meta name="copyright" content="ttan12138"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2020/08/06/web06/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Web前端 (6) ES6知识总结"><meta property="og:url" content="http://yoursite.com/2020/08/06/web06/"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="可以说ECMAScript 是 JavaScript 语言的国际标准，JavaScript 是 ECMAScript 的实现。 let&amp;const命令​    ES6 新增了 let 命令，用来声明变量，使用它声明的变量只在所在的代码块中有效。 ​    ES6 新增了 const 命令，用来声明常量，使用它声明的常量只在所在的代码块中有效。    let声明变量 var声明变量 cons"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-08-06T11:24:41.000Z"><meta property="article:modified_time" content="2020-08-08T13:27:29.130Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="Web前端 (3) JavaScript基础知识总结" href="http://yoursite.com/2020/08/06/web03/"><link rel="next" title="Hello World" href="http://yoursite.com/2020/08/01/hello-world/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 5.0.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">7</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#let-amp-const%E5%91%BD%E4%BB%A4"><span class="toc-number">1.</span> <span class="toc-text">let&amp;const命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Symbol"><span class="toc-number">2.</span> <span class="toc-text">Symbol</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC"><span class="toc-number">3.</span> <span class="toc-text">解构赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F-%E5%AF%B9%E8%B1%A1%E4%BB%A3%E7%90%86Proxy"><span class="toc-number">4.</span> <span class="toc-text">代理模式-对象代理Proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reflect"><span class="toc-number">5.</span> <span class="toc-text">Reflect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">箭头函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">7.</span> <span class="toc-text">扩展运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95"><span class="toc-number">8.</span> <span class="toc-text">数组方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Map%E5%92%8CSet"><span class="toc-number">9.</span> <span class="toc-text">Map和Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">10.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1"><span class="toc-number">11.</span> <span class="toc-text">对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="toc-number">12.</span> <span class="toc-text">面向对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON%E5%AF%B9%E8%B1%A1"><span class="toc-number">13.</span> <span class="toc-text">JSON对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8-Iterator-%E4%B8%8Efor%E2%80%A6of"><span class="toc-number">14.</span> <span class="toc-text">迭代器(Iterator)与for…of</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise"><span class="toc-number">15.</span> <span class="toc-text">Promise</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Generator%E5%87%BD%E6%95%B0"><span class="toc-number">16.</span> <span class="toc-text">Generator函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#async%E5%87%BD%E6%95%B0"><span class="toc-number">17.</span> <span class="toc-text">async函数</span></a></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Hexo</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Web前端 (6) ES6知识总结</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-08-06 19:24:41"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-08-06</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-08-08 21:27:29"><i class="fas fa-history fa-fw"></i> 更新于 2020-08-08</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/web%E5%89%8D%E7%AB%AF/">web前端</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>可以说ECMAScript 是 JavaScript 语言的国际标准，JavaScript 是 ECMAScript 的实现。</p>
<h4 id="let-amp-const命令"><a href="#let-amp-const命令" class="headerlink" title="let&amp;const命令"></a>let&amp;const命令</h4><p>​    ES6 新增了 let 命令，用来声明变量，使用它声明的变量只在所在的代码块中有效。</p>
<p>​    ES6 新增了 const 命令，用来声明常量，使用它声明的常量只在所在的代码块中有效。</p>
<table>
<thead>
<tr>
<th align="center">let声明变量</th>
<th align="center">var声明变量</th>
<th align="center">const声明常量</th>
</tr>
</thead>
<tbody><tr>
<td align="center">没有变量提升</td>
<td align="center">有变量提升</td>
<td align="center">没有变量提升</td>
</tr>
<tr>
<td align="center">块级作用域</td>
<td align="center">无块级作用域，是函数作用域</td>
<td align="center">有块级作用域</td>
</tr>
<tr>
<td align="center">不能重复声明</td>
<td align="center">可重复声明</td>
<td align="center">不能重复声明</td>
</tr>
<tr>
<td align="center">可重新赋值</td>
<td align="center">可重新赋值</td>
<td align="center">不能重新赋值</td>
</tr>
</tbody></table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">//Cannot access &#x27;a&#x27; before initialization at …………</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(x) <span class="comment">//Cannot access &#x27;x&#x27; before initialization at …………</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span></span><br><span class="line"><span class="keyword">const</span> x = <span class="number">3</span> <span class="comment">//const x;  Missing initializer in const declaration</span></span><br><span class="line"></span><br><span class="line">;&#123;</span><br><span class="line">  <span class="keyword">let</span> c = <span class="number">1</span></span><br><span class="line">  <span class="keyword">var</span> d = <span class="number">2</span></span><br><span class="line">  <span class="keyword">const</span> y = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(c) <span class="comment">//Error c is not defined</span></span><br><span class="line"><span class="built_in">console</span>.log(d) <span class="comment">//2</span></span><br><span class="line"><span class="built_in">console</span>.log(y) <span class="comment">//Error y is not defined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">5</span>    <span class="comment">//Identifier &#x27;a&#x27; has already been declared</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>   <span class="comment">//console.log(b) --&gt; 10</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">5</span>  <span class="comment">//console.log(a) --&gt; 5</span></span><br><span class="line">b = <span class="number">10</span> <span class="comment">//console.log(b) --&gt; 10</span></span><br><span class="line"></span><br><span class="line">x = <span class="number">4</span>    <span class="comment">//TypeError: Assignment to constant variable </span></span><br><span class="line"><span class="keyword">const</span> x = <span class="number">4</span> <span class="comment">//Identifier &#x27;x&#x27; has already been declared</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>块级作用域可以代替匿名函数写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(function()&#123;</span><br><span class="line">  var a &#x3D; 1;</span><br><span class="line">  ………………</span><br><span class="line">&#125;());</span><br><span class="line">&#x3D;&#x3D;&gt;</span><br><span class="line">&#123;</span><br><span class="line">  let a &#x3D; 2;</span><br><span class="line">  ………………</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h4><p>​    ES6中引入的原始数据类型Symbol，表示独一无二的值。Symbol 是JavaScript 在ES6 中一种基本数据类型。</p>
<ul>
<li><p>Symbol() 函数返回的是 Symbol 类型的值，该类型具有静态方法和静态属性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sym1 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">var</span> sym2 = <span class="built_in">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> sym3 = <span class="built_in">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>每一个 Symbol() 返回的值都是唯一的。一个Symbol 值能作为对象属性的标识符，这是改数据类型仅有的目的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Symbol</span>(<span class="string">&quot;abc&quot;</span>) === <span class="built_in">Symbol</span>(<span class="string">&quot;abc&quot;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不可以使用 new 操作符创建</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sym = <span class="keyword">new</span> <span class="built_in">Symbol</span>();  <span class="comment">// TypeError报错</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>结合 Object() 函数，创建一个 Symbol 包装器对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sym = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">typeof</span> sym;    <span class="comment">// &quot;symbol“”</span></span><br><span class="line"><span class="keyword">var</span> symobj = <span class="built_in">Object</span>(sym);</span><br><span class="line"><span class="keyword">typeof</span> symobj;  <span class="comment">// &quot;object&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>全局共享 Symbol</p>
<p>Symbol.for(key) 可以根据键值key从运行的symbol表中找对应symbol，找到即返回，找不到新建一个放到注册表中。</p>
</li>
<li><p>对象中查找symbol属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">Symbol</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">Symbol</span>.for(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">obj[a] = <span class="string">&quot;localSymbol&quot;</span>;</span><br><span class="line">obj[b] = <span class="string">&quot;globalSymbol&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> objectSymbols = <span class="built_in">Object</span>.getOwnPropertySymbols(obj);</span><br><span class="line"><span class="built_in">console</span>.log(objectSymbols)         <span class="comment">// [Symbol(a), Symbol(b)]</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>symbol静态属性：</p>
<ul>
<li><p>symbol.length –&gt;0</p>
</li>
<li><p>symbol.iterator –&gt;该方法为每一个对象定义了默认的迭代器。该迭代器可以被 for.. of 循环使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义迭代</span></span><br><span class="line"><span class="keyword">var</span> myIterator = &#123;&#125;;</span><br><span class="line">theIterator[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;;</span><br><span class="line">[...theIterator] <span class="comment">// [1, 2, 3]</span></span><br><span class="line"><span class="comment">//for……in迭代</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">obj[<span class="built_in">Symbol</span>(<span class="string">&quot;a&quot;</span>)] = <span class="string">&quot;a&quot;</span>;</span><br><span class="line">obj[<span class="built_in">Symbol</span>.for(<span class="string">&quot;b&quot;</span>)] = <span class="string">&quot;b&quot;</span>;</span><br><span class="line">obj[<span class="string">&quot;c&quot;</span>] = <span class="string">&quot;c&quot;</span>;</span><br><span class="line">obj.d = <span class="string">&quot;d&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(i);<span class="comment">// “c” &quot;d&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Symbol.replace<br> 指定了当一个字符串替换所匹配字符串时所调用的方法。String.prototype.replace() 会调用此方法。</p>
</li>
<li><p>Symbol.search<br> 指定了一个搜索方法，这个方法接受用户输入的正则表达式，返回该正则表达式在字符串中匹配到的下标，String.prototype.search()会调用此方法。</p>
</li>
<li><p>Symbol.split<br> 指向 一个正则表达式的索引处分割字符串的方法。 String.prototype.split() 会调用此方法。</p>
</li>
<li><p>其他属性</p>
<ul>
<li>Symbol.hasInstance<br>一个确定一个构造器对象识别的对象是否为它的实例的方法。使用 instanceof.</li>
<li>Symbol.isConcatSpreadable<br>一个布尔值，表明一个对象是否应该flattened为它的数组元素。使用Array.prototype.concat().</li>
<li>Symbol.unscopables<br>拥有和继承属性名的一个对象的值被排除在与环境绑定的相关对象外。</li>
<li>Symbol.species<br>一个用于创建派生对象的构造器函数。</li>
<li>Symbol.toPrimitive<br>一个将对象转化为基本数据类型的方法。</li>
<li>Symbol.toStringTag<br>用于对象的默认描述的字符串值。使用Object.prototype.toString().</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h4><ul>
<li><p>左右两边结构必须一样；</p>
</li>
<li><p>右边必须是个东西，东西–&gt;对象/数组；</p>
</li>
<li><p>声明和赋值不能分开(必须在一句话里完成)；            </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">注:<span class="keyword">let</span> &#123;a,b&#125; = &#123;<span class="number">70</span>,<span class="number">10</span>&#125;</span><br><span class="line">   <span class="comment">//右边什么也不是！！</span></span><br><span class="line"><span class="keyword">let</span> [a,b];</span><br><span class="line">[a,b] = [<span class="number">40</span>,<span class="number">10</span>];</span><br><span class="line">  <span class="comment">//声明和赋值是一句，不能分开！！！</span></span><br><span class="line"><span class="keyword">let</span> [a,b,c] = [<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a,b,c); <span class="comment">//7,8,9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [&#123;a,b&#125;,[n1,n2,n3],x,y] = [&#123;<span class="attr">a</span>:<span class="number">10</span>,<span class="attr">b</span>:<span class="number">11</span>&#125;,[<span class="number">10</span>,<span class="number">9</span>,<span class="number">8</span>],<span class="literal">true</span>,<span class="string">&#x27;flase&#x27;</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a,b,n1,n2,n3,x,y); <span class="comment">//10 11 10 9 8 true &quot;flase&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [json,arr5,x,y] = [&#123;<span class="attr">a</span>:<span class="number">10</span>,<span class="attr">b</span>:<span class="number">11</span>&#125;,[<span class="number">10</span>,<span class="number">9</span>,<span class="number">8</span>],<span class="literal">true</span>,<span class="string">&#x27;flase&#x27;</span>];</span><br><span class="line"><span class="built_in">console</span>.log(json,json.a,arr4,x,y); <span class="comment">//&#123;a: 10, b: 11&#125; 10 [10, 9, 8] true &quot;flase&quot;</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
<h4 id="代理模式-对象代理Proxy"><a href="#代理模式-对象代理Proxy" class="headerlink" title="代理模式-对象代理Proxy"></a>代理模式-对象代理Proxy</h4><p>​    所谓的代理者是指一个类别可以作为其它东西的接口。代理者可以作任何东西的接口：网络连接、内存中的大对象、文件或其它昂贵或无法复制的资源。</p>
<p>​    Proxy的主要作用就是可以对对象进行拦截，以及对数据读取、修改的过滤保护。Proxy 可以理解成，在目标对象之前架设一层“拦截”，外界对该对象的访问，都必须先通过这层拦截，因此提供了一种机制，可以对外界的访问进行过滤和改写。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Person = &#123;</span><br><span class="line">    name:<span class="string">&#x27;es6&#x27;</span>,</span><br><span class="line">    sex:<span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">    age:<span class="number">12</span>,</span><br><span class="line">    _prop:<span class="number">18</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//var proxy = new Proxy(target, handler); //target拦截目标对象 handle定制拦截行为</span></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> <span class="built_in">Proxy</span>(Person,&#123;</span><br><span class="line">  <span class="comment">// get:获取某个属性时触发  target是代理的数据即Person，value是要操作的那个属性 可继承</span></span><br><span class="line">  get(target,value)&#123;</span><br><span class="line">    <span class="keyword">return</span> target[value];</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// set:当设置某个属性时触发 target是代理的数据即Person，key是要操作的属性，value是属性的值</span></span><br><span class="line">  set(target,key,value)&#123;</span><br><span class="line">    <span class="keyword">if</span>(key !== <span class="string">&#x27;sex&#x27;</span>)</span><br><span class="line">      target[key] = value;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//has:判断对象是否具有某个属性时生效,典型的操作就是in运算符。target代理的数据,key是判断的属性</span></span><br><span class="line">  has (target, key) &#123;</span><br><span class="line">    <span class="keyword">if</span>(key[<span class="number">0</span>] === <span class="string">&#x27;_&#x27;</span>)&#123;  <span class="comment">//设置_属性隐藏/不可扩展/不可配置</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> key <span class="keyword">in</span> target;<span class="comment">//for……in不会触发拦截</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//deleteProperty:拦截删除 target是代理的数据即Person，key是要删除的属性</span></span><br><span class="line">  deleteProperty: <span class="function">(<span class="params">target, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(key.startsWith(<span class="string">&#x27;_&#x27;</span>))&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;私有属性进制删除哦~&#x27;</span>)                       </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">delete</span> target[key]</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`删除<span class="subst">$&#123;key&#125;</span>键成功~`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.table(&#123;</span><br><span class="line">  name:person.name,</span><br><span class="line">  sex:person.sex,</span><br><span class="line">  age:person.age</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;, &#123;</span><br><span class="line">    <span class="comment">//construct:拦截new </span></span><br><span class="line">   <span class="comment">//target：目标对象 args：构造函数的参数对象 newTarget：创造实例对象时，new命令作用的构造函数,如p()</span></span><br><span class="line">  construct: <span class="function"><span class="keyword">function</span>(<span class="params">target, args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;called: &#x27;</span> + args.join(<span class="string">&#x27;, &#x27;</span>));</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">value</span>: args[<span class="number">0</span>] * <span class="number">10</span> &#125;;  <span class="comment">//construct必须返回对象 </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">(<span class="keyword">new</span> p(<span class="number">1</span>)).value</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">...n</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(n)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;i am fn&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> newfn = <span class="keyword">new</span> <span class="built_in">Proxy</span>(fn,&#123;</span><br><span class="line">  apply(fn)&#123;</span><br><span class="line">    <span class="keyword">let</span> res = fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>[<span class="number">2</span>])</span><br><span class="line">      <span class="comment">// 可以获取函数返回值</span></span><br><span class="line">      <span class="built_in">console</span>.log( res )</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;i am in proxy&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(newfn(<span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/apply">handler.apply()</a></td>
<td>拦截 Proxy 实例作为函数调用的操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/construct">handler.construct()</a></td>
<td>拦截 Proxy 实例作为函数调用的操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/defineProperty">handler.defineProperty()</a></td>
<td>拦截 Object.defineProperty() 的操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/deleteProperty">handler.deleteProperty()</a></td>
<td>拦截 Proxy 实例删除属性操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get">handler.get()</a></td>
<td>拦截 读取属性的操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/set">handler.set()</a></td>
<td>拦截 属性赋值的操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getOwnPropertyDescriptor">handler.getOwnPropertyDescriptor()</a></td>
<td>拦截 Object.getOwnPropertyDescriptor() 的操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getPrototypeOf">handler.getPrototypeOf()</a></td>
<td>拦截 获取原型对象的操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/has">handler.has()</a></td>
<td>拦截 属性检索操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/isExtensible">handler.isExtensible()</a></td>
<td>拦截 Object.isExtensible()操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/ownKeys">handler.ownKeys()</a></td>
<td>拦截 Object.getOwnPropertyDescriptor() 的操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/preventExtensions">handler.preventExtension()</a></td>
<td>拦截 Object().preventExtension() 操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/setPrototypeOf">handler.setPrototypeOf()</a></td>
<td>拦截Object.setPrototypeOf()操作</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/revocable">Proxy.revocable()</a></td>
<td>创建一个可取消的 Proxy 实例</td>
</tr>
</tbody></table>
<p><strong>Proxy中的this指向</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在 Proxy 代理的情况下，目标对象内部的this关键字会指向 Proxy 代理。</span></span><br><span class="line"><span class="keyword">const</span> target = &#123;</span><br><span class="line">  m: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span> === proxy);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> handler = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br><span class="line"></span><br><span class="line">target.m() <span class="comment">// false</span></span><br><span class="line">proxy.m() <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h4 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h4><p><code>Reflect</code>对象与<code>Proxy</code>对象一样，也是 ES6 为了操作对象而提供的新 API。把文档中所有的对象统一管理，所有对象里的所有属性和方法都能在reflect里边找到。</p>
<ul>
<li><p><strong>只要Proxy对象具有的代理方法，Reflect对象全部具有，以静态方法的形式存在。这些方法能够执行默认行为，无论Proxy怎么修改默认行为，总是可以通过Reflect对应的方法获取默认行为。</strong></p>
</li>
<li><p><strong>新增的方法与现有一些方法功能重复，新增的方法会取代现有的方法</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 推荐使用reflect来操作对象，而不是直接操作对象，符合函数式变成的写法</span></span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;</span><br><span class="line">  name: <span class="string">&#x27;abai&#x27;</span>,</span><br><span class="line">  phone: <span class="string">&#x27;15000112222&#x27;</span>,</span><br><span class="line">  makeName()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;reflect实例123&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.get(obj2,<span class="string">&#x27;name&#x27;</span>),<span class="built_in">Reflect</span>.has(obj2, <span class="string">&#x27;sweet&#x27;</span>))</span><br><span class="line"><span class="built_in">Reflect</span>.set(obj2, <span class="string">&#x27;sweet&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>方法描述</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/apply">handler.apply()</a></td>
<td>通过指定的参数列表发起对目标函数的调用</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/construct">handler.construct()</a></td>
<td>此方法行为有点像 new 操作符构造函数，相当于运行 new target(…args)</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/defineProperty">handler.defineProperty()</a></td>
<td>方法功能类似于Object.defineProperty()方法</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/deleteProperty">handler.deleteProperty()</a></td>
<td>功能类似于delete运算符</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/get">handler.get()</a></td>
<td>从对象获取指定属性值</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/set">handler.set()</a></td>
<td>设置指定对象的属性，比如为对象添加新属性或者修改原有属性的值</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/getOwnPropertyDescriptor">handler.getOwnPropertyDescriptor()</a></td>
<td>功能类似于Object.getOwnPropertyDescriptor()</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/getPrototypeOf">handler.getPrototypeOf()</a></td>
<td>获取对象的原型对象</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/has">handler.has()</a></td>
<td>获取对象的原型对象</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/isExtensible">handler.isExtensible()</a></td>
<td>判断一个对象是否是可扩展的</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys">handler.ownKeys()</a></td>
<td>返回一个数组，此数组中包含有参数对象自有属性名称</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/preventExtensions">handler.preventExtension()</a></td>
<td>将对象设置为不可扩展</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/setPrototypeOf">handler.setPrototypeOf()</a></td>
<td>设置指定对象的原型对象</td>
</tr>
<tr>
<td><strong>实现观察者模式</strong></td>
<td></td>
</tr>
</tbody></table>
<p>​    观察者模式（Observer mode）指的是函数自动观察数据对象，一旦对象有变化，函数就会自动执行。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=<span class="string">&quot;testinp&quot;</span> /&gt;</span><br><span class="line">&lt;div&gt;实时更新的数据: <span class="xml"><span class="tag">&lt;<span class="name">i</span>  <span class="attr">id</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span>&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> oInput = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;testinp&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> oText = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;text&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> handler = &#123;</span><br><span class="line">  set: <span class="function">(<span class="params">target,key,val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(key === <span class="string">&#x27;text&#x27;</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(val !== oInput.value)&#123;oInput.value = val&#125;</span><br><span class="line">      oText.innerHTML = val</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="built_in">Reflect</span>.set(target,key,val)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  get: <span class="function">(<span class="params">target, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> textObj = <span class="keyword">new</span> <span class="built_in">Proxy</span>(oText, handler)</span><br><span class="line"></span><br><span class="line">oInput.addEventListener(<span class="string">&#x27;keyup&#x27;</span>,<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  textObj.text = e.target.value</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;textObj.text = <span class="string">&#x27;initValue&#x27;</span>&#125;,<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>其他应用</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//操作节点（切换两个不同的元素的属性或类名）</span></span><br><span class="line"><span class="keyword">let</span> view = <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;</span><br><span class="line">  selected: <span class="literal">null</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  set: <span class="function"><span class="keyword">function</span>(<span class="params">obj, prop, newval</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> oldval = obj[prop];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (prop === <span class="string">&#x27;selected&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (oldval) &#123;</span><br><span class="line">        oldval.setAttribute(<span class="string">&#x27;aria-selected&#x27;</span>, <span class="string">&#x27;false&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (newval) &#123;</span><br><span class="line">        newval.setAttribute(<span class="string">&#x27;aria-selected&#x27;</span>, <span class="string">&#x27;true&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The default behavior to store the value</span></span><br><span class="line">    obj[prop] = newval;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i1 = view.selected = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;item-1&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(i1.getAttribute(<span class="string">&#x27;aria-selected&#x27;</span>)); <span class="comment">// &#x27;true&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i2 = view.selected = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;item-2&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(i1.getAttribute(<span class="string">&#x27;aria-selected&#x27;</span>)); <span class="comment">// &#x27;false&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(i2.getAttribute(<span class="string">&#x27;aria-selected&#x27;</span>)); <span class="comment">// &#x27;true&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对象多重继承</span></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  name: <span class="string">&quot;obj-1&quot;</span>,</span><br><span class="line">  foo() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&quot;obj1.foo:&quot;</span>, <span class="built_in">this</span>.name );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">obj2 = &#123;</span><br><span class="line">  name: <span class="string">&quot;obj-2&quot;</span>,</span><br><span class="line">  foo() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&quot;obj2.foo:&quot;</span>, <span class="built_in">this</span>.name );</span><br><span class="line">  &#125;,</span><br><span class="line">  bar() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">&quot;obj2.bar:&quot;</span>, <span class="built_in">this</span>.name );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">handlers = &#123;</span><br><span class="line">  get(target,key,context) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Reflect</span>.has( target, key )) &#123;<span class="comment">//有对应属性则转发</span></span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key, context);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;<span class="comment">//没有则遍历父对象列表</span></span><br><span class="line">      <span class="comment">//Symbol.for(&quot;[[Prototype]]&quot;)表示要继承的多个父对象</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> P <span class="keyword">of</span> target[<span class="built_in">Symbol</span>.for( <span class="string">&quot;[[Prototype]]&quot;</span> )]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Reflect</span>.has( P, key )) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(P, key, context)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">obj3 = <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;</span><br><span class="line">  name: <span class="string">&quot;obj-3&quot;</span>,</span><br><span class="line">  baz() &#123;</span><br><span class="line">    <span class="built_in">this</span>.foo();</span><br><span class="line">    <span class="built_in">this</span>.bar();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,handlers);</span><br><span class="line"></span><br><span class="line">obj3[<span class="built_in">Symbol</span>.for(<span class="string">&quot;[[Prototype]]&quot;</span>)] = [obj1, obj2];</span><br><span class="line">obj3.baz();</span><br><span class="line"><span class="comment">//obj1.foo:obj-3</span></span><br><span class="line"><span class="comment">//obj2.bar:obj-3</span></span><br></pre></td></tr></table></figure>

<h4 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h4><ul>
<li><p>只有一个参数 () 可以省略</p>
</li>
<li><p>只有一个return {return} 可以省略</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a1 = <span class="built_in">document</span>.getElementById(<span class="string">&quot;a1&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> show1 = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line">show1(<span class="number">3</span>, <span class="number">4</span>); </span><br><span class="line">a1.innerHTML = show1(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">            </span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">19</span>]</span><br><span class="line"></span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span>(<span class="params">n1, n2</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n1 - n2;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// arr.sort((n1, n2) =&gt; n1 - n2)</span></span><br><span class="line">a1.innerHTML = arr.sort(<span class="function">(<span class="params">n1, n2</span>) =&gt;</span> n1 - n2)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="扩展运算符"><a href="#扩展运算符" class="headerlink" title="扩展运算符"></a>扩展运算符</h4><ul>
<li>收集剩余数组<br>Rest Parameter 必须是最后一个</li>
<li>展开数组<br>展开后的效果，跟直接把数组放到那里效果相同                    </li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注：不允许赋值</span></span><br><span class="line"><span class="comment">//默认参数：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b = <span class="number">4</span>, c = <span class="number">5</span></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> openArr = <span class="function">(<span class="params">a, b, ...args</span>) =&gt;</span> args; <span class="comment">//不能在...args后面接参数</span></span><br><span class="line"><span class="keyword">var</span> a2 = <span class="built_in">document</span>.getElementById(<span class="string">&quot;a2&quot;</span>);</span><br><span class="line">a2.innerHTML = openArr(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>);  <span class="comment">//6,7,8,9</span></span><br><span class="line">            </span><br><span class="line"><span class="keyword">let</span> show2 = <span class="function">(<span class="params">a, b, c</span>) =&gt;</span> a + <span class="string">&quot; &quot;</span> + b + <span class="string">&quot; &quot;</span> + c; </span><br><span class="line">            </span><br><span class="line"><span class="comment">// a2.innerHTML = show2(4, 5, 6);</span></span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="comment">// a2.innerHTML = show2(...arr2);</span></span><br><span class="line"><span class="keyword">let</span> arr3 = [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line">             </span><br><span class="line"><span class="keyword">let</span> arr4 = [...arr2, ...arr3]; </span><br><span class="line">a2.innerHTML = arr4;  <span class="comment">//[4,5,6,7,8,9]</span></span><br></pre></td></tr></table></figure>
<h4 id="数组方法"><a href="#数组方法" class="headerlink" title="数组方法"></a>数组方法</h4><ul>
<li>map           映射        一个对一个</li>
</ul>
<p>​       [10,15,20,25]  [“001”,”002”，”003”]<br>​       [A, B, C, D]   [{leavl:”ss”,name:”q”},  {leavl:”sss”,name:”w”}, {leavl:”sp”,name:”e”}]</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用：</span></span><br><span class="line">arr.map(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">  alert(item);</span><br><span class="line">  <span class="comment">// 对数组进行操作</span></span><br><span class="line">&#125;);</span><br><span class="line">联合箭头函数：</span><br><span class="line">arr.map = <span class="function"><span class="params">item</span> =&gt;</span> &#123;alert(item);&#125;;                            </span><br></pre></td></tr></table></figure>

<ul>
<li><p>reduce        汇总        一堆出一个</p>
<p>算总数   [10,12,54] =&gt; 76<br>算给平均分   [12,15,18] =&gt; 15</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用：</span></span><br><span class="line">arr.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">tmp,item,index</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// add: return tmp+item;</span></span><br><span class="line">  <span class="comment">// avg:</span></span><br><span class="line">  <span class="keyword">if</span>(item == index)&#123;</span><br><span class="line">    <span class="keyword">return</span> (tmp+item) / (index+<span class="number">1</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> tmp+item;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/* [10,12,15,18]</span></span><br><span class="line"><span class="comment">tmp      item     index     sum</span></span><br><span class="line"><span class="comment">10       12       1       22</span></span><br><span class="line"><span class="comment">22       15       2       37</span></span><br><span class="line"><span class="comment">37       18       3       55</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
<li><p>filter        过滤器            留一部分消一部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用：</span></span><br><span class="line"><span class="keyword">let</span> result = arr.filter(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;); <span class="comment">//Array[0]</span></span><br><span class="line">                        </span><br><span class="line"><span class="keyword">let</span> result = arr.filter(<span class="function"><span class="params">item</span>=&gt;</span>item &gt;= <span class="number">15</span>?<span class="literal">true</span>:<span class="literal">false</span>); <span class="comment">//15,18</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>forEach        循环(迭代)  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.forEach(<span class="function">(<span class="params">item,index</span>)=&gt;</span>item+index);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="Map和Set"><a href="#Map和Set" class="headerlink" title="Map和Set"></a>Map和Set</h4><p>​    ES6 中引入了4种新的数据结构: 集合（Set）、弱集合（WeakSet）、映射（Map）、弱映射（WeakMap）</p>
<ul>
<li><p>Set: Set 对象是值的集合，可以按照插入的顺序迭代它的元素。Set 中的元素只会出现一次，即 Set 中的元素是唯一的。</p>
<p>语法: new Set([ iterable ]); // iterable:可迭代对象，所有元素添加到新的Set。</p>
<blockquote>
<p>由于 Set 中的值总是唯一的，所以需要判断两个值是否相等。在对象的扩展章节中，我们讲到可以通过Object.is() 来判断是否严格相等，在 Set 中，-0 和 +0 是两个不同的值，NaN 和 undefined 是可以被存储在 Set 中的，因为 NaN 在ES6中是严格相等的。</p>
</blockquote>
<p>属性：</p>
<ul>
<li>length 属性：0</li>
<li>Set.prototype: 表示Set构造器的原型，允许向所有Set对象添加新的属性。</li>
<li>Set.prototype.constructor: 返回实例构造函数，默认是Set。</li>
<li>Set.prototype.size: 返回Set对象的值的个数（ NaN不算值）。</li>
</ul>
<p>方法：</p>
<ul>
<li><p>Set.prototype.add(value): 对象尾部添加元素。</p>
</li>
<li><p>Set.prototype.clear(): 清除所有元素。</p>
</li>
<li><p>Set.prototype.has(value): 判断值是否存在于Set中。</p>
</li>
<li><p>Set.prototype.delete(value): 删除Set中元素。</p>
</li>
<li><p>遍历方法：</p>
<p>forEach(function) ：对Set每个元素执行一遍function。</p>
<p>keys()/values(): 通过.next()对每个元素的名/值进行遍历。</p>
<p>entries(): 通过.next()对每个元素的名+值进行遍历。</p>
</li>
</ul>
<p>应用：</p>
<p>Array与Set相互转换：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myArray = [<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>, <span class="string">&quot;value2&quot;</span>]</span><br><span class="line"><span class="comment">//使用构造器将Array转换为Set</span></span><br><span class="line"><span class="keyword">var</span> mySet = <span class="keyword">new</span> <span class="built_in">Set</span>(myArray) <span class="comment">//[&quot;value1&quot;, &quot;value2&quot;]</span></span><br><span class="line">myset.has(<span class="string">&quot;value1&quot;</span>) <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>数组去重：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用数组静态方法Array.from</span></span><br><span class="line"><span class="keyword">let</span> array1 = <span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>]))  <span class="comment">//1,2,3,4</span></span><br><span class="line"><span class="keyword">let</span> array2 = [...new <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>])]  <span class="comment">//1,2,3,4</span></span><br></pre></td></tr></table></figure>

<p>字符串转Set</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> text = <span class="string">&quot;abc&quot;</span></span><br><span class="line"><span class="keyword">var</span> stringSet = <span class="keyword">new</span> <span class="built_in">Set</span>(text) <span class="comment">//set(3)[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</span></span><br></pre></td></tr></table></figure>

<p>实现并集、交集、差集</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line"><span class="comment">//并集</span></span><br><span class="line"><span class="keyword">let</span> unionSect = <span class="keyword">new</span> <span class="built_in">Set</span>([...a,...b]);</span><br><span class="line"><span class="comment">//交集</span></span><br><span class="line"><span class="keyword">let</span> interSect = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function"><span class="params">x</span>=&gt;</span>b.has(x)))</span><br><span class="line"><span class="comment">//差集</span></span><br><span class="line"><span class="keyword">let</span> differSect = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function"><span class="params">x</span>=&gt;</span>!b.has(x)))</span><br></pre></td></tr></table></figure>
</li>
<li><p>WeakSet</p>
<ul>
<li>可以new创建的，与Set结构类似</li>
<li>与Set的区别<ul>
<li>成员只能是对象,不能是其他任何类型；</li>
<li>兑现弱引用,垃圾回收机制不考虑WeakSet对对象的引用；</li>
<li>没有size属性,不能遍历。</li>
</ul>
</li>
<li>方法：add，delete， has</li>
</ul>
</li>
<li><p>Map</p>
<p>Map对象保存键值对。任何值都可以作为一个键或一个值。</p>
<p>使用方法：new Map([iterable]) //iterable可以是数组或其他可迭代对象，或两个元素的数组</p>
<p>属性：</p>
<ul>
<li>length属性：0；</li>
<li>Map.prototype.constructor: 创建实例的原型，默认是Map函数；</li>
<li>Map.prototype.size: 返回对象键值对的数量。</li>
</ul>
<p>方法：</p>
<ul>
<li>Map.prototype.set(key,value)：返回设置完对应键值的Map对象；</li>
<li>Map.prototype.clear(): 移除所有键值对；</li>
<li>Map.prototype.has(“键名”)：是否包含键对应的值；</li>
<li>Map.prototype.delete(key): 移除任何键相关联的值，删除成功返回true；</li>
<li>Map.prototype.get(key): 返回键对应的值；没有键返回undefined。</li>
<li>遍历方法：<ul>
<li>keys()/values()/entries(): 按插入顺序返回键名/键值/键值对；</li>
<li>forEach(callback[,thisArg]): 为每一键值对执行一次callback函数，thisArg每次回调的this指向(可选)。</li>
</ul>
</li>
</ul>
<p>应用：</p>
<p>Map与Array相互转换</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myMap = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">myMap.add(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>)</span><br><span class="line">myMap.add(<span class="number">1</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">[...myMap];  <span class="comment">//[&quot;key&quot;,&quot;value&quot;][1,&quot;value&quot;]</span></span><br><span class="line"><span class="comment">//Array转Map</span></span><br><span class="line">cosnt arr = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>],[<span class="number">1</span>,<span class="string">&quot;value&quot;</span>]) <span class="comment">//Map&#123;&quot;key&quot;=&gt;&quot;value&quot;,1=&gt;&quot;value&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<p>Map与Object相互转换</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Map转object</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapToObject</span>(<span class="params">myMap</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> obj = <span class="built_in">Object</span>.creat(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> [k,v] <span class="keyword">of</span> myMap)&#123;</span><br><span class="line">   obj[k] = v</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> myMap = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">myMap.set(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>)</span><br><span class="line">myMap.set(<span class="number">1</span>,<span class="string">&quot;value&quot;</span>)</span><br><span class="line"></span><br><span class="line">mapToObject(myMap) <span class="comment">//Object &#123;1: &quot;value&quot;, key: &quot;value&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Object转Map</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">objectToMap</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> myMap = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> k <span class="keyword">of</span> <span class="built_in">Object</span>.keys(obj))&#123;</span><br><span class="line">    myMap.set(k,obj[k])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> myMap</span><br><span class="line">&#125;</span><br><span class="line">objectToMap(&#123;<span class="number">1</span>: <span class="string">&quot;value&quot;</span>, <span class="attr">key</span>: <span class="string">&quot;value&quot;</span>&#125;) <span class="comment">//Map&#123;&quot;1&quot;=&gt;&quot;value&quot;,&quot;key&quot;=&gt;&quot;value&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<p>Map与JSON相互转换</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Map转JSON </span></span><br><span class="line"><span class="comment">//Map键名为字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapTOJson</span>(<span class="params">myMap</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(mapToObject(myMap)) <span class="comment">//&#123;&quot;1&quot;: &quot;value&quot;, &quot;key&quot;: &quot;value&quot;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> myMap = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">myMap.set(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>)</span><br><span class="line">myMap.set(<span class="number">1</span>,<span class="string">&quot;value&quot;</span>) </span><br><span class="line">mapToJson(myMap)</span><br><span class="line"><span class="comment">//Map键名为非字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapToArrayJson</span>(<span class="params">map</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify([...map]) <span class="comment">//[[&quot;key&quot;,&quot;value&quot;][1,&quot;value&quot;]]</span></span><br><span class="line">&#125;</span><br><span class="line">mapToArrayJson(myMap)</span><br><span class="line"></span><br><span class="line"><span class="comment">//JSON转Map</span></span><br><span class="line"><span class="comment">// JSON对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonToStrMap</span>(<span class="params">jsonStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> objToStrMap(<span class="built_in">JSON</span>.parse(jsonStr));</span><br><span class="line">&#125;</span><br><span class="line">jsonToStrMap(&#123;<span class="string">&quot;1&quot;</span>: <span class="string">&quot;value&quot;</span>, <span class="string">&quot;key&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;); <span class="comment">//MapMap&#123;&quot;1&quot;=&gt;&quot;value&quot;,&quot;key&quot;=&gt;&quot;value&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 整个JSON 是数组</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonToMap</span>(<span class="params">jsronStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Map</span>(<span class="built_in">JSON</span>.parse(jsronStr)); </span><br><span class="line">&#125;</span><br><span class="line">jsonToMap([[<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>],[<span class="number">1</span>,<span class="string">&quot;value&quot;</span>]]); <span class="comment">// Map &#123;&quot;1&quot;=&gt;&quot;value&quot;,&quot;key&quot;=&gt;&quot;value&quot;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>WeakMap</p>
<ul>
<li><p>与Map结构类似，用于生成键值对的集合。</p>
</li>
<li><p>与Map的区别</p>
<ul>
<li>只接受对象作为键值(null除外)，用于生成键值对的集合</li>
<li>键名所指向的对象不计入垃圾回收机制</li>
<li>没有size, 不能遍历，不支持clear()</li>
</ul>
</li>
<li><p>应用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以DOM节点作为键名的场景应用</span></span><br><span class="line"><span class="keyword">let</span> myElement = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;logo&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> myWeakmap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span><br><span class="line"></span><br><span class="line">myWeakmap.set(myElement,&#123;<span class="attr">timeClicked</span>:<span class="number">0</span>&#125;)</span><br><span class="line">myElement.addEventListener(<span class="string">&#x27;click&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> logoData = myWeakmap.get(myElement)</span><br><span class="line">  logoData.timeClick++</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//部署私有属性</span></span><br><span class="line"><span class="keyword">const</span> _counter = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> _action = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Countdown</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(counter, action) &#123;</span><br><span class="line">    _counter.set(<span class="built_in">this</span>, counter);</span><br><span class="line">    _action.set(<span class="built_in">this</span>, action);</span><br><span class="line">  &#125;</span><br><span class="line">  dec() &#123;</span><br><span class="line">    <span class="keyword">let</span> counter = _counter.get(<span class="built_in">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (counter &lt; <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    counter--;</span><br><span class="line">    _counter.set(<span class="built_in">this</span>, counter);</span><br><span class="line">    <span class="keyword">if</span> (counter === <span class="number">0</span>) &#123;</span><br><span class="line">      _action.get(<span class="built_in">this</span>)();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">new</span> Countdown(<span class="number">2</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;DONE&#x27;</span>));</span><br><span class="line"></span><br><span class="line">c.dec()</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><ul>
<li><p>新增的方法</p>
<ul>
<li><p>startsWith(str，index)：返回布尔值，str是否在源字符串的头部；</p>
</li>
<li><p>endsWith(str，index)：返回布尔值，str是否在源字符串的尾部；</p>
</li>
<li><p>includes(str，index): 返回布尔值，表示是否找到了str。</p>
<blockquote>
<p>以上方法index可选，表示搜索开始位置。ends针对前index个字符。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;https://www.baidu.com&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(str.startsWith(<span class="string">&quot;http://&quot;</span>))&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;普通网址&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(str.startsWith(<span class="string">&quot;https://&quot;</span>))&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;加密网址&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(str.startsWith(<span class="string">&quot;git://&quot;</span>))&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;git地址&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;其他&quot;</span>)；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>repeat(num)：返回将字符串重复num次返回。</p>
</li>
<li><p>padStart(targetLength,str)</p>
</li>
<li><p>padEnd(targetLength,str)</p>
<blockquote>
<p>targetLength目标字符串长度；str用str补齐</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a&#x27;</span>.padStart(<span class="number">3</span>, <span class="string">&#x27;bb&#x27;</span>)  --&gt; bba</span><br><span class="line"><span class="string">&#x27;a&#x27;</span>.padEnd(<span class="number">7</span>, <span class="string">&#x27;bb&#x27;</span>)   --&gt;abbbbbb</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
</li>
<li><p>对Unicode 的支持：codePointAt()、fromCodePoint()</p>
<p>​    在ES5中，常使用charAt() 来表示字符存储位置，用charCodeAt() 来表示对应位置字符Unicode 的编码。在JavaScript 内部，字符以UTF-16 的形式存储，每个字符固定为2个字节，对于那些需要4个字节存储的字符并不支持。因此，ES6使用 codePointAt() 方法来支持存储4字节的字符：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">&#x27;猿&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(s.codePointAt(<span class="number">0</span>)); <span class="comment">// 29503</span></span><br></pre></td></tr></table></figure>

<p>​    在 ES5 中，从码点返回对应的字符的方法是 fromCharCode()，这个并不能返回字符为32位的utf-16 的字符。ES6 中使用 String.fromCodePoint() 代替：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>.fromCodePoint(<span class="number">29503</span>)); <span class="comment">// 猿</span></span><br></pre></td></tr></table></figure></li>
<li><p>字符串模板 –&gt; 字符串连接</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">let</span> sr = <span class="string">`</span></span><br><span class="line"><span class="string">   &lt;p&gt;<span class="subst">$&#123;a&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串的遍历接口： for..of…</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> <span class="built_in">str</span> of <span class="symbol">&#x27;asd</span>&#x27;) &#123;</span><br><span class="line">   console.log(<span class="built_in">str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a</span></span><br><span class="line"><span class="comment">// s</span></span><br><span class="line"><span class="comment">// d</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h4><ul>
<li><p>属性简写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age = <span class="number">18</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  age,    <span class="comment">//等同于age:age,</span></span><br><span class="line">  name: <span class="string">&#x27;小明&#x27;</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法简写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line"> showName()  &#123; </span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//等同于 showName:function()&#123;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>属性名表达式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = &#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&#x27;score&#x27;</span>,  <span class="comment">//result[&quot;type&quot;]</span></span><br><span class="line">  [value]: <span class="number">80</span>,        <span class="comment">//result[value]</span></span><br><span class="line">  [<span class="string">&#x27;showValue&#x27;</span>]()&#123;  <span class="comment">//result.showValue()</span></span><br><span class="line">  &#125;</span><br><span class="line">   <span class="comment">//result.showValue.name == showValue;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>其他方法</p>
<ul>
<li><p>Object.is() 判断两数值是否严格相等</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.is(+<span class="number">0</span>, <span class="number">-0</span>);  <span class="comment">//false</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="literal">NaN</span>, <span class="literal">NaN</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Object.assign() 将源对象sourceN所有可枚举属性复制到目标对象target。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.assign(target, source1, source2, ..., sourceN)；</span><br><span class="line"><span class="comment">//后来的被覆盖，不是对象的被转成对象，null/undefined不能放置在目标位置上。</span></span><br><span class="line"><span class="comment">//字符串会以数组形式复制到对象，其他值无效果</span></span><br><span class="line"><span class="keyword">let</span> a1 = <span class="string">&#x27;yuan&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> a2 = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> a3 = <span class="number">11</span>;</span><br><span class="line"><span class="keyword">let</span> a4 = <span class="literal">NaN</span>;</span><br><span class="line"><span class="built_in">Object</span>.assign(&#123;&#125;, a1, a2, a3, a4); <span class="comment">// &#123;0: &quot;y&quot;, 1: &quot;u&quot;, 2: &quot;a&quot;, 3: &quot;n&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//只是浅复制：尽量规避同名属性替换问题.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Object.keys()：返回对象自身的所有可枚举属性的键名数组。</p>
</li>
<li><p>for…in 循环：只遍历对象自身的和继承的可枚举性。</p>
</li>
</ul>
</li>
</ul>
<h4 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h4><p>面向对象：<br>                    1.多了个class关键字，构造器和类分开<br>                    2.class中直接放方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----new nethods:</span></span><br><span class="line"><span class="comment">// 【1】声明/构造/使用</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name,pass)&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.pass = pass;</span><br><span class="line">  &#125;</span><br><span class="line">                </span><br><span class="line">  showName()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">                </span><br><span class="line">  showPass()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.pass)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">            </span><br><span class="line"><span class="keyword">var</span> u2 = <span class="keyword">new</span> User(<span class="string">&#x27;red&#x27;</span>,<span class="string">&#x27;4321&#x27;</span>);</span><br><span class="line">u2.showName();</span><br><span class="line">u2.showPass();</span><br><span class="line">            </span><br><span class="line"><span class="comment">// 【2】继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VipUser</span> <span class="keyword">extends</span> <span class="title">User</span></span>&#123;            </span><br><span class="line">  <span class="keyword">constructor</span>(name,pass,level)&#123;</span><br><span class="line">    <span class="built_in">super</span>(name,pass);</span><br><span class="line">    <span class="built_in">this</span>.level = level;</span><br><span class="line">  &#125;</span><br><span class="line">                </span><br><span class="line">  <span class="comment">/* constructor(...arg1)&#123;</span></span><br><span class="line"><span class="comment">    super(...arg1);</span></span><br><span class="line"><span class="comment">  &#125; */</span></span><br><span class="line">  showLevel()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.level);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> v2 = <span class="keyword">new</span> VipUser(<span class="string">&#x27;black&#x27;</span>,<span class="string">&#x27;54321&#x27;</span>,<span class="string">&#x27;ss&#x27;</span>);</span><br><span class="line">v2.showName();</span><br><span class="line">v2.showPass();</span><br><span class="line">v2.showLevel();</span><br><span class="line"></span><br><span class="line"><span class="comment">//----old methods :</span></span><br><span class="line"><span class="comment">//【1】声明/构造/使用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Users</span>(<span class="params">name, pass</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.pass = pass;</span><br><span class="line">&#125;</span><br><span class="line">                </span><br><span class="line">Users.prototype.showName=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line">                </span><br><span class="line">Users.prototype.showPass=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.pass);</span><br><span class="line">&#125;</span><br><span class="line">                </span><br><span class="line"><span class="keyword">var</span> u1 = <span class="keyword">new</span> Users(<span class="string">&#x27;blue&#x27;</span>,<span class="string">&#x27;1234&#x27;</span>);</span><br><span class="line">u1.showName();</span><br><span class="line">u1.showPass();</span><br><span class="line"><span class="comment">// 【2】继承</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">VipUsers</span>(<span class="params">name,pass,level</span>)</span>&#123;</span><br><span class="line">  Users.call(<span class="built_in">this</span>,name,pass);</span><br><span class="line">  <span class="built_in">this</span>.level = level;</span><br><span class="line">&#125;</span><br><span class="line">                </span><br><span class="line">VipUsers.prototype = <span class="keyword">new</span> Users();</span><br><span class="line">                </span><br><span class="line">VipUsers.prototype.constructor = VipUsers;</span><br><span class="line">                </span><br><span class="line">VipUsers.prototype.showLevel = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.level);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> v1 = <span class="keyword">new</span> VipUsers(<span class="string">&#x27;green&#x27;</span>,<span class="string">&#x27;12345&#x27;</span>,<span class="string">&#x27;ss&#x27;</span>)</span><br><span class="line">v1.showName()</span><br><span class="line">v1.showPass()</span><br><span class="line">v1.showLevel()</span><br></pre></td></tr></table></figure>

<h4 id="JSON对象"><a href="#JSON对象" class="headerlink" title="JSON对象"></a>JSON对象</h4><ul>
<li><p>JSON.stringify</p>
</li>
<li><p>JSON.parse</p>
</li>
<li><p>简写 名字一样  名字跟值一样 留一个</p>
<pre><code>                    方法 show()&#123;~~~&#125;</code></pre>
<p>标准写法：</p>
<pre><code>1.只能用双引号
2.所有名字都必须用引号包起来</code></pre>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> json = &#123;<span class="attr">a</span>:<span class="number">12</span>,<span class="attr">b</span>:<span class="number">15</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;http://www.baidu.com/user?data=&#x27;</span>+<span class="built_in">encodeURIComponent</span>(<span class="built_in">JSON</span>.stringify(json)) ;</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure>

<h4 id="迭代器-Iterator-与for…of"><a href="#迭代器-Iterator-与for…of" class="headerlink" title="迭代器(Iterator)与for…of"></a>迭代器(Iterator)与for…of</h4><ul>
<li><p>迭代器</p>
<p>​     迭代器是带有特殊接口的对象。含有一个next()方法，调用返回一个包含两个属性的对象，分别是value和done，<strong>value表示当前位置的值</strong>，<strong>done表示是否迭代完</strong>，当为true的时候，调用next就无效了。迭代器可以统一处理所有集合数据的方法迭代器是一个接口，只要该数据结构暴露了一个iterator的接口，就可以完成迭代，Iterator接口主要供for…of消费。</p>
<ul>
<li>默认Iterator接口：部署在数据结构的Symbol.iterable属性，即该数据结构只要有可遍历(iterable)的数据，就说是可遍历的。</li>
<li>调用了iterator的场合：解构赋值、扩展运算符、Generator 函数中的 yield* 表达式、for…of、Array.from、Map()、Set()、Promise.all()、Promise.race()</li>
</ul>
</li>
<li><p>遍历器 for…of（可以配合continue,return,break使用，几乎可遍历所有数据）</p>
<p><strong>遍历器是一种线性处理，对于任何非线性的数据结构，部署遍历器接口就等于部署一种线性变换</strong>。</p>
<blockquote>
<p>支持for…of的原生数据结构</p>
<ul>
<li><p>Array</p>
</li>
<li><p>Map</p>
</li>
<li><p>Set</p>
</li>
<li><p>String</p>
</li>
<li><p><strong>TypedArray（一种通用的固定长度缓冲区类型，允许读取缓冲区中的二进制数据）</strong></p>
</li>
<li><p>函数中的 arguments 对象</p>
</li>
<li><p>NodeList 对象</p>
</li>
<li><p>对象的遍历需要开发者指定。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对象遍历</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Obj</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.value = value;</span><br><span class="line">  <span class="built_in">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">Obj.prototype[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> iterator = &#123;</span><br><span class="line">    next: next</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> current = <span class="built_in">this</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (current) &#123;</span><br><span class="line">      <span class="keyword">var</span> value = current.value;</span><br><span class="line">      current = current.next;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: <span class="literal">false</span>,</span><br><span class="line">        value: value</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: <span class="literal">true</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> iterator;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> one = <span class="keyword">new</span> Obj(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> two = <span class="keyword">new</span> Obj(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> three = <span class="keyword">new</span> Obj(<span class="number">3</span>);</span><br><span class="line">one.next = two;</span><br><span class="line">two.next = three;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> one) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
<li><p>应用迭代器</p>
<ul>
<li>斐波那契数列<br>定义一个数组迭代器，每次都迭代输出一个新的值，直到斐波那契数列有两个运行前提，第一个前提是初始化的前两个数字为0，1,第二个前提是将来的每一个值都是前两个值的和。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> it = &#123; [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">  &#125;,</span><br><span class="line">  n1: <span class="number">0</span>,</span><br><span class="line">  n2: <span class="number">1</span>,</span><br><span class="line">  next() &#123;</span><br><span class="line">    <span class="keyword">let</span> temp1 = <span class="built_in">this</span>.n1,</span><br><span class="line">    temp2 = <span class="built_in">this</span>.n2;</span><br><span class="line">    [<span class="built_in">this</span>.n1, <span class="built_in">this</span>.n2] = [temp2, temp1 + temp2]</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      value: temp1,</span><br><span class="line">      done: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(it.next())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>任务队列迭代器<br>定义一个任务队列，该队列初始化时为空，将待处理的任务传递后，传入数据进行处理。第一次传递的数据只会被任务１处理，第二次传递的只会被任务２处理… </li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Task = &#123;</span><br><span class="line">  actions: [],</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">var</span> steps = <span class="built_in">this</span>.actions.slice();</span><br><span class="line">    <span class="keyword">return</span> &#123; [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      next(...args) &#123;</span><br><span class="line">        <span class="keyword">if</span> (steps.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> res = steps.shift()(...args);</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            value: res,</span><br><span class="line">            done: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> &#123;</span><br><span class="line">             done: <span class="literal">true</span></span><br><span class="line">           &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Task.actions.push(<span class="function"><span class="keyword">function</span> <span class="title">task1</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;任务一：相乘&quot;</span>) </span><br><span class="line">  <span class="keyword">return</span> args.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * y</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> <span class="title">task2</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;任务二：相加&quot;</span>) <span class="keyword">return</span> args.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">  &#125;) * <span class="number">2</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> <span class="title">task3</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;任务三：相减&quot;</span>) <span class="keyword">return</span> args.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x - y</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> it = Task[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line"><span class="built_in">console</span>.log(it.next(<span class="number">10</span>, <span class="number">100</span>, <span class="number">2</span>));</span><br><span class="line"><span class="built_in">console</span>.log(it.next(<span class="number">20</span>, <span class="number">50</span>, <span class="number">100</span>)) <span class="built_in">console</span>.log(it.next(<span class="number">10</span>, <span class="number">2</span>, <span class="number">1</span>))</span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">任务一：相乘 &#123;</span></span><br><span class="line"><span class="comment">  &quot;value&quot;: 2000,</span></span><br><span class="line"><span class="comment">  &quot;done&quot;: false</span></span><br><span class="line"><span class="comment">&#125;任务二：相加 &#123;</span></span><br><span class="line"><span class="comment">  &quot;value&quot;: 340,</span></span><br><span class="line"><span class="comment">  &quot;done&quot;: false</span></span><br><span class="line"><span class="comment">&#125;任务三：相减 &#123;</span></span><br><span class="line"><span class="comment">  &quot;value&quot;: 7,</span></span><br><span class="line"><span class="comment">  &quot;done&quot;: false</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br></pre></td></tr></table></figure>

<ul>
<li>延迟执行<br> 假设我们有一个数据表，我们想按大小顺序依次的获取数据，但是我们又不想提前给他排序，有可能我们根本就不去使用它，所以我们可以在第一次使用的时候再排序，做到延迟执行代码：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> table = &#123;</span><br><span class="line">  <span class="string">&quot;d&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;b&quot;</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="string">&quot;c&quot;</span>: <span class="number">12</span>,</span><br><span class="line">  <span class="string">&quot;a&quot;</span>: <span class="number">12</span></span><br><span class="line">&#125;</span><br><span class="line">table[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">var</span> keys = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (keys === <span class="literal">null</span>) &#123;</span><br><span class="line">        keys = <span class="built_in">Object</span>.keys(_this).sort();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        value: keys[index],</span><br><span class="line">        done: index++&gt;keys.length</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> a <span class="keyword">of</span> table) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// a b c d</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><p>Promise对象用于<strong>异步操作</strong>，它表示一个尚未完成且预计在未来完成的异步操作。</p>
<p>–&gt;<strong>异步操作可以一起执行多个任务，函数调用后不会立即返回执行的结果。</strong></p>
<p>–&gt;<strong>异步任务总是在当前脚本执行完同步任务后才执行任务</strong>。</p>
<p> –&gt; <strong>回调地狱</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">reqest(<span class="string">&#x27;1.html&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data1</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;第一次请求成功，返回了&quot;</span>，data1)</span><br><span class="line">  request(<span class="string">&#x27;2.html&#x27;</span>,data1,<span class="function"><span class="keyword">function</span>(<span class="params">data2</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;第二次请求成功，返回了&#x27;</span>，data2)</span><br><span class="line">    request(<span class="string">&#x27;3.html&#x27;</span>,data2,<span class="function"><span class="keyword">function</span>(<span class="params">data3</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;第三次请求成功，返回了&#x27;</span>,data3)</span><br><span class="line">      ……………………</span><br><span class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error3</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;第三次请求失败，失败信息&#x27;</span>, error3)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error2</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;第二次请求失败, 失败信息&quot;</span>, error2)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error1</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第一次请求失败，失败信息&#x27;</span>, error1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>以上代码出现多层嵌套，而且只是简单地打印了一下请求数据和失败数据，看起来既冗余又不利于编程和维护。</p>
<p>–&gt; <strong>promise.then链式回调</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sendRequest(<span class="string">&#x27;1.html&#x27;</span>,<span class="string">&#x27;&#x27;</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">data1</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第一次请求成功，返回了&#x27;</span>, data1)</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data2</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第二次请求成功，返回了&#x27;</span>, data2)</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data3</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;第三次请求成功，返回了&#x27;</span>, data3)</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//用catch捕捉前面的错误</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;请求失败&#x27;</span>, error)；</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Promise基本用法</p>
<p>Promise三种状态：</p>
<ul>
<li>Pending –&gt; 进行中,初始状态</li>
<li>Fulfilled  –&gt; 操作成功</li>
<li>Rejected –&gt; 操作失败</li>
</ul>
<p>状态由Pending改变为Fulfilled或者Rejected之后，会<strong>凝固</strong>，不会再发生变化。状态改变时，then绑定的函数会被调用。</p>
</li>
<li><p>Promise基本方法</p>
<ul>
<li><p>.then()</p>
<blockquote>
<p>语法：Promise.prototype.then(onFulfilled, onRejected)</p>
<p>​     Promise对象状态发生改变时根据改变后状态选择回调函数onFulfilled/onRejected执行，执行后返回新的Promise对象。如上then链式回调中<code>.then.then</code>，上一个then结束的Promise发生变化下一个then重新选择执行……。</p>
</blockquote>
</li>
<li><p>.catch()</p>
<blockquote>
<p>语法：Promise.prototype.catch(onRejected)</p>
<p>​     捕获操作失败时发生的错误; catch能捕捉链式回调中前面所有then方法抛出的错误，捕获catch发生的错误需要在后面接一个catch。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//其他捕获写法</span></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;错误&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">  reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;错误&#x27;</span>));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//状态凝固，当Promise先请求成功了，状态不会变为rejected，不会被catch</span></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve();</span><br><span class="line">  <span class="keyword">throw</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.catch(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(e);      <span class="comment">//This is never called</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//在回调函数前抛异常</span></span><br><span class="line"><span class="keyword">var</span> p1 = &#123; </span><br><span class="line">  then: <span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    resolve(<span class="string">&quot;Resolved&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="built_in">Promise</span>.resolve(p1);</span><br><span class="line">p2.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//not called</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);       <span class="comment">// =&gt; Error: error</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//在回调函数后抛异常</span></span><br><span class="line"><span class="keyword">var</span> p3 = &#123; </span><br><span class="line">  then: <span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="string">&quot;Resolved&quot;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p4 = <span class="built_in">Promise</span>.resolve(p3);</span><br><span class="line">p4.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);     <span class="comment">// =&gt; Resolved</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//not called</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>​     如果没有使用 catch 方法指定处理错误的回调函数，Promise 对象抛出的错误不会传递到外层代码，即不会有任何反应（chrome 会抛错，Safari 和 Firefox 不抛错），这是 Promise 的一个缺点。</p>
</blockquote>
</li>
<li><p>.all()</p>
<blockquote>
<p>语法：Promise.all(iterable)</p>
<p>​    Promise.all 方法接受一个数组（或具有 Iterator 接口的对象）作为参数，数组中的对象（[p1, p2, p3）均为 Promise 实例（如果不是一个 Promise，该项会被用 Promise.resolve 转换为一个 Promise），实例是同时开始、并行执行的，它的状态由这个上 Promise 实例决定。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> promise(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">3000</span>, <span class="string">&#x27;first&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> promise(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">    resolve(<span class="string">&#x27;second&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> p3 = <span class="keyword">new</span> promise(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>, <span class="string">&#x27;third&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//当三个实例的状态都变为Fulfilled，p的状态菜户变为 Fulfilled，并将三个Promise返回的结果，按照参数的顺序（而不是resolved的顺序）存入数组，传给p的回调函数。</span></span><br><span class="line"><span class="built_in">Promise</span>.all([p1, p2, p3]).then(<span class="function"><span class="keyword">function</span>(<span class="params">values</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(values)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p4 = <span class="keyword">new</span> promise(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">3000</span>, <span class="string">&#x27;one&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> p5 = <span class="keyword">new</span> promise(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">    reject(<span class="string">&#x27;two&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> p6 = <span class="keyword">new</span> promise(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(reject, <span class="number">1000</span>, <span class="string">&#x27;three&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//- 当三个实例中有一个装填为 rejected，p 的状态也会变为 rejected，并把第一个 reject 的 Promise 的返回值，传给 p 的回调函数.</span></span><br><span class="line"><span class="built_in">Promise</span>.all([p4, p6, p5]).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, data)</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;reject&#x27;</span>,error) <span class="comment">//==&gt;reject two</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>.race()</p>
<blockquote>
<p>语法：Promise.race(iterable)</p>
<p>​     参数参考all()方法，Promise.race()将多个Promise实例打包为一个实例，参数中任一实例状态发生变化，总实例状态跟着改变，并将第一个改变状态的参数实例的返回值传给p的回调函数。</p>
</blockquote>
</li>
<li><p>.reaolve()</p>
<blockquote>
<p>语法：Promise.resolve(value)</p>
<p>​            Promise.resolve(promise)</p>
<p>​            Promise.resolve(thenable)</p>
<p>让Promise对象立即进入Fulfilled状态，返回新的Promise对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">&#x27;Success&#x27;</span>);<span class="comment">//可以将带then方法的对象转换为Promise对象，支持后接.then</span></span><br><span class="line"><span class="comment">//等同于</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="string">&#x27;Success&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>.reject()</p>
<blockquote>
<p>同上resolve</p>
<p>状态转为rejected</p>
</blockquote>
</li>
</ul>
</li>
<li><p>其他方法</p>
<ul>
<li><p>.done()</p>
<blockquote>
<p>语法：asyncFunc().then(f1).catch(r1).then(f2).done();</p>
<p>总是处于回调链尾端，保证抛出任何可能出现的错误。</p>
</blockquote>
</li>
<li><p>.finally()</p>
<blockquote>
<p>可以接受一个普通回调函数做参数，不管怎样都必须执行。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>注意</p>
<ul>
<li>Promise一旦创建，无法中途取消；</li>
<li>如果不设置回调函数，内部抛错不会反应到外部；</li>
<li>处于pending状态不能确定现在进行到哪里。</li>
<li>构造器中书写的逻辑，即使发生意外输出，rejected状态绝大多数情况能正常返回。在没有明确throw时，最好使用reject。</li>
</ul>
</li>
<li><p>自测： <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/30797777">https://zhuanlan.zhihu.com/p/30797777</a></p>
</li>
</ul>
<h4 id="Generator函数"><a href="#Generator函数" class="headerlink" title="Generator函数"></a>Generator函数</h4><p>Generator即生成器，生成器对象由Generator 函数返回。</p>
<blockquote>
<p>语法： </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = gen(); <span class="comment">//&quot;Generator&#123; &#125;&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p>生成器函数特征：</p>
<ul>
<li><p><code>*</code>  在function关键字与函数名之间(空格一般没有特殊要求，等多的是如上语法所示)；</p>
</li>
<li><p>函数内部使用了yield表达式，用于定义Generator函数中的状态；</p>
</li>
<li><p>调用Generator函数时，不会立即执行，返回的是Iterator对象，通过调用next()方法依次遍历每个状态;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">gen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> g = gen()   <span class="comment">// Iterator对象</span></span><br><span class="line"><span class="comment">//每次调用next()返回value-done ,可参看iterator中next</span></span><br><span class="line"><span class="comment">//value没有返回值或者为undefined,说明函数运行结束</span></span><br><span class="line">g.next() <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">g.next() <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line">g.next() <span class="comment">// &#123;value: 3, done: true&#125;</span></span><br><span class="line">g.next() <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>使用Generator</p>
<ul>
<li><p>yield 表达式：定义内部状态或暂停执行</p>
<ul>
<li><p>yield表达式用在另一个表达式中需加上（），做函数参数和语句时可以不使用（）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">gen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span> + <span class="keyword">yield</span>) <span class="comment">// ×</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span> + (<span class="keyword">yield</span>)) <span class="comment">// √</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span> + <span class="keyword">yield</span> <span class="string">&#x27;凯斯&#x27;</span>) <span class="comment">// ×</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span> + (<span class="keyword">yield</span> <span class="string">&#x27;凯斯&#x27;</span>))  <span class="comment">//√</span></span><br><span class="line">  foo(<span class="keyword">yield</span> <span class="number">1</span>)  <span class="comment">//√</span></span><br><span class="line">  <span class="keyword">const</span> param = <span class="keyword">yield</span> <span class="number">2</span> <span class="comment">// √</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>yield* 表达式: 在一个Generator函数调用另一个Generator函数时使用</p>
<ul>
<li><p>如下代码不能实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">gen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> foo()</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> g = gen()</span><br><span class="line">g.next()   <span class="comment">// &#123;value: Generator, done: false&#125;</span></span><br><span class="line">g.next()   <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line">g.next()   <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>yield* 可以看做是for…of</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">gen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span>* foo()</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*等同于</span></span><br><span class="line"><span class="comment">function* gen()&#123;</span></span><br><span class="line"><span class="comment">  for(let item of foo())&#123;</span></span><br><span class="line"><span class="comment">    yield item</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">  yield 2</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> g = gen()</span><br><span class="line">g.next()   <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">g.next()   <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line">g.next()   <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>yield* 可以遍历具有Iterator接口的数据类型</p>
</li>
<li><p>yield* 取出嵌套数组中的成员</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通方法</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, [[<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>]]</span><br><span class="line"><span class="keyword">const</span> str = arr.toString().replace(<span class="regexp">/,/g</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">//1234</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> str) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(+item)      <span class="comment">// 1, 2, 3, 4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用yield*表达式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">gen</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(arr)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">      <span class="keyword">yield</span>* gen(arr[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span> arr</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> g = gen([<span class="number">1</span>, [[<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>]])</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> g) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item)       <span class="comment">// 1, 2, 3, 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>next作用</p>
<ul>
<li>next的作用是分段执行Generator函数</li>
<li>每次调用next从函数头/上一次停止的地方开始，直到遇见下一个yield或return语句停止，返回包含value和done的对象。</li>
</ul>
</li>
<li><p>next执行逻辑</p>
<ul>
<li>①遇到yield表达式，暂停执行后面的操作，并将紧跟在yield表达式后面的那个表达式的值，作为返回的对象的value属性值。</li>
<li>②下一次调用next方法时，再继续往下执行，遇到yield表达式返回①</li>
<li>③如果没有再遇到新的yield表达式，继续向下运行，直到遇到return语句为止，将return语句后面表达式的值，作为返回的对象的value属性值。</li>
<li>④如果该函数没有return语句，则返回的对象的value属性值为undefined。</li>
</ul>
</li>
<li><p>next方法参数</p>
<ul>
<li>yield语句本身没有返回值，返回的总是上一个yield句的值，总会返回undefined</li>
<li>当next传入参数时，参数会被当做上一个yield语句的返回值</li>
</ul>
</li>
<li><p><strong>yield语句表达式向函数外传递数据，next()向函数内传递值</strong></p>
</li>
</ul>
</li>
<li><p>遍历Generator对象</p>
<p>任何一个对象的Symbol.iterator属性都指向默认的遍历器对象生成函数，Generator函数也是遍历器对象生成函数，所以将Generator函数赋值给Symbol.iterator属性，使得对象具有Iterator接口，从而可以被遍历。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  name: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">  height: <span class="number">180</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> arr = <span class="built_in">Object</span>.keys(<span class="built_in">this</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    <span class="keyword">yield</span> [item, <span class="built_in">this</span>[item]]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">person[<span class="built_in">Symbol</span>.iterator] = gen</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> person) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key, value)   <span class="comment">// name 小明 , height 180</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//省去next遍历</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> item <span class="keyword">of</span> gen2())&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item) <span class="comment">//1 2 3 4 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>相关应用</p>
<ul>
<li><p>协程 ：指多个线程相互协作，完成异步任务</p>
<p>ES6中实现协程，其最大特点是可以交出函数的执行权</p>
<p>整个Generator函数是一个封装的异步任务，或者说是异步任务的容器。异步操作需要暂停的地方只需都用yield语句注明即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="keyword">yield</span> x + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = gen(<span class="number">1</span>);</span><br><span class="line">g.next(); <span class="comment">// &#123; value: 3, done: false &#125;;</span></span><br><span class="line">g.next(); <span class="comment">// &#123; value: undefined; done: true &#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Thunk函数：自动执行Generator函数的方法</p>
<p>起源于“求值策略”中的“传名调用”，即函数的参数应在执行时求值。<strong>将参数放到一个临时函数之中，再将这个临时函数传入函数体。这个临时函数就叫做 Thunk 函数。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ES5 版本转换器</span><br><span class="line">var Thunk &#x3D; function(fn) &#123;</span><br><span class="line">  return function () &#123;</span><br><span class="line">    var args &#x3D; Array.prototype.slice.call(arguments);</span><br><span class="line">    return function (callback) &#123;</span><br><span class="line">      args.push(callback);</span><br><span class="line">      return fn.apply(this, arg);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ES6 版本转换器</span><br><span class="line">const Thunk &#x3D; function(fn) &#123;</span><br><span class="line">  return function(...args) &#123;</span><br><span class="line">    return function(callback) &#123;</span><br><span class="line">      return fn.call(this, ...args, callback);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以下使用了node.js模块fs读文件方法，做多参数函数实例</span></span><br><span class="line">fs.readFile(fileName, callback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Thunk版本的readFile（单参数版本）</span></span><br><span class="line"><span class="keyword">var</span> readFileThunk = Thunk(fs.readFile);</span><br><span class="line">readFileThunk(fileName)(callback);</span><br></pre></td></tr></table></figure>

<p><strong>自动执行Generator函数</strong>:yield后面接的异步操作必须是Thunk函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> gen = fn();</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = gen.next(data);</span><br><span class="line">    <span class="keyword">if</span>(result.done) <span class="keyword">return</span>;</span><br><span class="line">    result.value(next);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">g</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run(g);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Co模块：将Thunk函数与Promise对象包装成为一个模块</p>
<p>前提：yield后必须是Thunk函数或Promise对象</p>
<ul>
<li>并发操作放在数组里</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">co(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> res = <span class="keyword">yield</span> [</span><br><span class="line">    <span class="built_in">Promise</span>.resolve(<span class="number">1</span>),</span><br><span class="line">    <span class="built_in">Promise</span>.resolve(<span class="number">2</span>)</span><br><span class="line">  ];</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(onerror);</span><br></pre></td></tr></table></figure>

<ul>
<li>并发操作写在对象里</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">co(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> res = <span class="keyword">yield</span> &#123;</span><br><span class="line">    <span class="number">1</span>: <span class="built_in">Promise</span>.resolve(<span class="number">1</span>),</span><br><span class="line">    <span class="number">2</span>: <span class="built_in">Promise</span>.resolve(<span class="number">2</span>)</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(onerror);</span><br></pre></td></tr></table></figure>

<ul>
<li>处理多个 generator 异步操作</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">co(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> valuse = [n1, n2, n3];</span><br><span class="line">  <span class="keyword">yield</span> values.map(somethingAsync);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">somethingAsync</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do something async</span></span><br><span class="line">  <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//允许并发 3 个 somethingAsync 异步操作</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="async函数"><a href="#async函数" class="headerlink" title="async函数"></a>async函数</h4><ul>
<li><p>async函数的优势</p>
<ul>
<li><p>内置执行器: async 函数自带执行器，不需要像 Generator 函数需要 co 模块实现自动流程管理。像调用普通函数一样：asyncReadFile() ，只要一行;</p>
</li>
<li><p>更好的语义性：async 和 await 比起星号和 yield，语义更清楚。async 表示函数里有异步操作，await 表示紧跟在后面的表达式需要等待结果;</p>
</li>
<li><p>更广的适用性: co 模块约定，yield 命令后面只能是 Thunk 函数 或 Promise对象，而 async 函数的 await 命令后面，可以是 Promise 对象和原始类型的值(原始值相当于同步操作)；</p>
</li>
<li><p>返回值是Promise：可用then指定下一步操作。</p>
</li>
<li><p><strong>可以认为：async 函数是 Generator 函数的语法糖，是由多个异步操作包装成的一个 Promise 对象，而 await 命令就是内部 then 命令的语法糖。</strong></p>
</li>
</ul>
</li>
<li><p>用法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params">[param[, param[, ... param]]]</span>) </span>&#123; statements &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用场景</span></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line"><span class="keyword">const</span> = foo = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象的方法</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="keyword">async</span> foo() &#123;&#125; &#125;;</span><br><span class="line">obj.foo().then(...);</span><br><span class="line"></span><br><span class="line"><span class="comment">// calss 的方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Storage</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="built_in">this</span>.cachePromise = caches.open(<span class="string">&#x27;yuan&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> getYuan(name) &#123;</span><br><span class="line">    <span class="keyword">const</span> cache = <span class="keyword">await</span> <span class="built_in">this</span>.cachePromise;</span><br><span class="line">    <span class="keyword">return</span> cache.match(<span class="string">`/yuan/<span class="subst">$&#123; name &#125;</span> .png`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> storage = <span class="keyword">new</span> Storage();</span><br><span class="line">storage.getYuan(<span class="string">&#x27;monkey&#x27;</span>).then(...);</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回Promise对象</p>
<p>async函数内部return语句返回的值可以作为回调函数的参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">helloAsync</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;helloAsync&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="built_in">console</span>.log(helloAsync())  <span class="comment">// Promise &#123;&lt;resolved&gt;: &quot;helloAsync&quot;&#125;</span></span><br><span class="line"> </span><br><span class="line">helloAsync().then(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v);         <span class="comment">// helloAsync</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Promise对象的状态变化</p>
<p>只有async 函数内部的 await 命令执行完，才会执行 then 方法指定的回调函数。</p>
</li>
<li><p>await命令</p>
<ul>
<li><p>await 操作符用于等待一个 Promise 对象, 它只能在异步函数 async function 内部使用</p>
<blockquote>
<p>await针对所跟不同表达式的处理方式：</p>
<ul>
<li>Promise 对象：await 会暂停执行，等待 Promise 对象 resolve，然后恢复 async 函数的执行并返回解析值。</li>
<li>await 命令后的 Promise 对象如果有一个变为 reject 状态，则整个 async 函数都会中断， reject 的参数会被 catch 方法的回调函数接收到。</li>
<li>非 Promise 对象：直接返回对应的值，即自动转为一个resolve的Promise对象。</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p>注意点</p>
<ul>
<li><p>await 关键字仅在 async function 中有效。如果在 async function 函数体外使用 await ，你只会得到一个语法错误。</p>
</li>
<li><p>await 命令后面的 Promise 对象运行的结果可能是 reject 的状态，所以最好把 await 命令放在 try…catch 代码块里，或者在await 命令后加一个 catch 方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// await 命令写在 try...catch </span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> somePromise();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 await 后加 catch</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> somePromise()</span><br><span class="line">  .catch (<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多个 await 后面的异步操作如果不存在继发关系，最好让他们同时出发</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = <span class="keyword">await</span> getFoo();</span><br><span class="line"><span class="keyword">let</span> bar = <span class="keyword">await</span> getBar();</span><br></pre></td></tr></table></figure>
</li>
<li><p>多个请求并发执行，可以使用 Promise.all 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">dbFunc</span>(<span class="params">db</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;];</span><br><span class="line">  <span class="keyword">let</span> promises = doc.map((doc) = &gt; db.post(doc));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> results = <span class="keyword">await</span> <span class="built_in">Promise</span>.all(promises);</span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>异步应用对比：Promise、Generator、async</p>
<p>以 setTimeout 来模拟异步操作：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.setTimeout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data = &#123;</span><br><span class="line">          height: <span class="number">180</span></span><br><span class="line">        &#125;</span><br><span class="line">        data = <span class="built_in">Object</span>.assign(&#123;&#125;, obj, data)</span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.setTimeout(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data = &#123;</span><br><span class="line">          talk () &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.name, <span class="built_in">this</span>.height);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        data = <span class="built_in">Object</span>.assign(&#123;&#125;, obj, data)</span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125;, <span class="number">1500</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>两个函数都返回了 Promise 对象，使用 Object.assign() 方法合并传递过来的参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// Promise 实现异步：</span></span><br><span class="line"><span class="comment">//此方法的缺点：语义不好，不够直观，使用多个 then 方法，有可能出现回调地狱。</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">main</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = &#123;</span><br><span class="line">        name: <span class="string">&#x27;keith&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      resolve(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  main().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    foo(data).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      bar(res).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data.talk()   <span class="comment">// keith 180</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// Generator 函数实现异步：</span></span><br><span class="line"><span class="comment">//Generator 函数相较于 Promise 实现异步操作，优点在于：异步过程同步化，避免回调地狱的出现。缺点在于：需要借助run 函数或者 co 模块实现流程的自动管理。</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> *<span class="title">gen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">    name: <span class="string">&#x27;keith&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">const</span> fooData = <span class="keyword">yield</span> foo(data)</span><br><span class="line">    <span class="keyword">const</span> barData = <span class="keyword">yield</span> bar(fooData)</span><br><span class="line">    <span class="keyword">return</span> barData.talk()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">run</span> (<span class="params">gen</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> g = gen()</span><br><span class="line">    <span class="keyword">const</span> next = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> result = g.next(data)</span><br><span class="line">      <span class="keyword">if</span> (result.done) <span class="keyword">return</span> result.value</span><br><span class="line">      result.value.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        next(data)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">  run(gen)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// async 函数实现异步：</span></span><br><span class="line">  <span class="comment">//async 函数优点在于：实现了执行器的内置，代码量减少，且异步过程同步化，语义化更强。</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">    name: <span class="string">&#x27;keith&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> fooData = <span class="keyword">await</span> foo(data)</span><br><span class="line">  <span class="keyword">const</span> barData = <span class="keyword">await</span> bar(fooData)</span><br><span class="line">    <span class="keyword">return</span> barData</span><br><span class="line">&#125;</span><br><span class="line">  main().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    data.talk()</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>其他应用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从豆瓣API上获取数据：</span></span><br><span class="line"><span class="keyword">var</span> fetchDoubanApi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) = &gt;&#123;</span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> response;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        response = <span class="built_in">JSON</span>.parse(xhr.responseText);</span><br><span class="line">                    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">                        reject(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (response) &#123;</span><br><span class="line">                        resolve(response, xhr.status, xhr);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    reject(xhr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;https://api.douban.com/v2/user/aisk&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">        xhr.setRequestHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line">        xhr.send(data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> result = <span class="keyword">await</span> fetchDoubanApi();</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据电影名称，下载对应的海报**</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;request&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> movieDir = __dirname + <span class="string">&#x27;/movies&#x27;</span>,</span><br><span class="line">exts = [<span class="string">&#x27;.mkv&#x27;</span>, <span class="string">&#x27;.avi&#x27;</span>, <span class="string">&#x27;.mp4&#x27;</span>, <span class="string">&#x27;.rm&#x27;</span>, <span class="string">&#x27;.rmvb&#x27;</span>, <span class="string">&#x27;.wmv&#x27;</span>];</span><br><span class="line"><span class="comment">// 读取文件列表</span></span><br><span class="line"><span class="keyword">var</span> readFiles = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        fs.readdir(movieDir,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err, files</span>) </span>&#123;</span><br><span class="line">            resolve(files.filter((v) = &gt;exts.includes(path.parse(v).ext)));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 获取海报</span></span><br><span class="line"><span class="keyword">var</span> getPoster = <span class="function"><span class="keyword">function</span>(<span class="params">movieName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">`https: //api.douban.com/v2/movie/search?q=<span class="subst">$&#123;<span class="built_in">encodeURI</span>(movieName)&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        request(&#123;</span><br><span class="line">            url: url,</span><br><span class="line">            json: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">error, response, body</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (error) <span class="keyword">return</span> reject(error);</span><br><span class="line">            resolve(body.subjects[<span class="number">0</span>].images.large);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 保存海报</span></span><br><span class="line"><span class="keyword">var</span> savePoster = <span class="function"><span class="keyword">function</span>(<span class="params">movieName, url</span>) </span>&#123;</span><br><span class="line">    request.get(url).pipe(fs.createWriteStream(path.join(movieDir, movieName + <span class="string">&#x27;.jpg&#x27;</span>)));</span><br><span class="line">&#125;; </span><br><span class="line">(<span class="keyword">async</span>() = &gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> files = <span class="keyword">await</span> readFiles();</span><br><span class="line">    <span class="comment">// await只能使用在原生语法</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">        <span class="keyword">let</span> name = path.parse(file).name;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`正在获取【$ &#123;</span></span><br><span class="line"><span class="string">            name</span></span><br><span class="line"><span class="string">        &#125;】的海报`</span>);</span><br><span class="line">        savePoster(name, <span class="keyword">await</span> getPoster(name));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;=== 获取海报完成 ===&#x27;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ttan12138</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/08/06/web06/">http://yoursite.com/2020/08/06/web06/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Hexo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web%E5%89%8D%E7%AB%AF/">web前端</a><a class="post-meta__tags" href="/tags/%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/">知识总结</a><a class="post-meta__tags" href="/tags/ES6/">ES6</a><a class="post-meta__tags" href="/tags/ES7/">ES7</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/08/06/web03/"><img class="prev-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Web前端 (3) JavaScript基础知识总结</div></div></a></div><div class="next-post pull-right"><a href="/2020/08/01/hello-world/"><img class="next-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hello World</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/08/06/web01/" title="web前端 (1) Html基础知识总结"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-06</div><div class="relatedPosts_title">web前端 (1) Html基础知识总结</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/06/web02/" title="Web前端 (2) CSS基础知识总结"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-06</div><div class="relatedPosts_title">Web前端 (2) CSS基础知识总结</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/06/web04/" title="Web前端 (4) JavaScript进阶"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-06</div><div class="relatedPosts_title">Web前端 (4) JavaScript进阶</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/06/web05/" title="Web前端 (5) JS简单实践（一）"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-06</div><div class="relatedPosts_title">Web前端 (5) JS简单实践（一）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/06/web03/" title="Web前端 (3) JavaScript基础知识总结"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-06</div><div class="relatedPosts_title">Web前端 (3) JavaScript基础知识总结</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By ttan12138</div><div class="framework-info"><span>驱动 </span><a target="_blank" rel="noopener" href="https://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script></body></html>